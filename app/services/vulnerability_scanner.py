import requests

def scan_requirements(reqs: str):
    results = []
    for line in reqs.strip().splitlines():
        if "==" in line:
            pkg, version = line.strip().split("==")
            query = f"https://osv-vulnerabilities.storage.googleapis.com/PyPI/{pkg}.json"
            try:
                response = requests.get(query)
                vulns = []
                if response.status_code == 200:
                    data = response.json()
                    for vuln in data.get("vulns", []):
                        for affected in vuln.get("affected", []):
                            ranges = affected.get("ranges", [])
                            for r in ranges:
                                introduced = r.get("introduced")
                                fixed = r.get("fixed")
                                vulns.append({
                                    "id": vuln["id"],
                                    "summary": vuln.get("summary", ""),
                                    "introduced": introduced,
                                    "fixed": fixed
                                })
                results.append({
                    "package": pkg,
                    "version": version,
                    "vulnerabilities": vulns
                })
            except Exception as e:
                results.append({
                    "package": pkg,
                    "version": version,
                    "error": str(e)
                })
    return results
